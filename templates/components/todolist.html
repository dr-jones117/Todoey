{{define "todoLists"}}
    {{range .TodoLists}}
        {{template "todoList" .}}
    {{end}}
    <div class="mt-20">&nbsp;</div>
    <script>
      function afterSwapTodoListContainer(event) {
        let container = event.target;
        if(event.detail.requestConfig.headers['HX-Trigger'] === 'create-todo-btn') {
          container.scrollTop = container.scrollHeight;
        }
      }
    </script>
{{end}}

{{define "todoList"}}
  <div 
    id="todoList-{{.Id}}"
    class="htmx-zoom-out group/todolist md:dark:bg-gray-700 rounded md:px-5 py-5 my-3 md:my-4 mx-0 md:mx-3 max-w-screen md:shadow-lg rounded-lg w-full md:w-auto"
  >
      <!-- Title Input Field -->
    <div class="flex justify-between p-2">
      <input 
        name="title"
        type="text"
        placeholder="Title"
        value="{{.Title}}"

        hx-put="/todo-lists"
        hx-trigger="input changed delay:1s"
        hx-swap="innerHTML"
        hx-vals='{"id": {{.Id}}}'

        class="placeholder:text-gray-500 p-0 md:px-2 py-1 text-sm font-bold border-0 focus:outline-none text-lg block"
      />

      {{template "delete-todolist-btn" .}}
    </div>

      <!-- Todo List Container -->
      <div 
        id="todoList-container-{{.Id}}"
        class="overflow-auto no-scrollbar bg-gradient-to-bl dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 w-screen md:w-auto from-blue-100 via-indigo-100 to-purple-100  dark:bg-gray-600 md:rounded-lg mt-3 h-57"
        hx-on::after-swap="afterSwapTodoListContainer(event)"
      >
        {{range .Todos}}
            {{template "todo" .}}
        {{end}}
      </div>
      {{template "create-todo-btn" .}}
  </div>
{{end}}

{{define "create-todo-btn"}}
    <button 
      id="create-todo-btn"
      hx-post="/todos" 
      hx-target="#todoList-container-{{.Id}}" 
      hx-swap="beforeend transition:true" 
      hx-vals='{"todolistid": {{.Id}}}'
      class="p-2 mt-3 ml-3 text-xs md:ml-0 flex justify-center items-center font-medium tracking-wide transition duration-300 transform bg-green-500 rounded-md hover:bg-green-400 hover:scale-105"
    >
      {{template "plus-icon" .}} Add Todo
    </button>
{{end}}


{{define "delete-todolist-btn"}}
    <button 
      hx-delete="/todo-lists" 
      hx-target="#todoList-{{.Id}}" 
      hx-swap="outerHTML swap:300ms" 
      hx-vals='{"todolistid": {{.Id}}}'
      hx-trigger="confirmed"
      onClick="
        Swal.fire({
          title: 'Delete Todo List?', 
          text:'Are you sure you want to delete this todo list?', 
          confirmButtonColor: '#fb2c38',
          confirmButtonText: 'Yes',
          showCancelButton: true,
          cancelButtonColor: '#00c84e'
        }).then((result)=>{
            if(result.isConfirmed){
              htmx.trigger(this, 'confirmed');  
            } 
        })"

      class="px-2 py-2 transition duration-300 transform bg-transparent rounded-full opacity-100 lg:opacity-0 group-hover/todolist:opacity-100 hover:bg-red-500"
    >
      {{template "x-mark-icon" .}}
    </button>
{{end}}
