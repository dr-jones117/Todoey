{{define "todo"}}
{{$todoId := printf "todo-%d" .Id}}
{{$todoValueId := printf "%s-value" $todoId}}
{{$todoCompletedId := printf "%s-completed" $todoId}}
<form 
    id="todo-{{$.Id}}"

    hx-put="/todos" 
    hx-swap="outerHTML"
    hx-trigger="keyup delay:1s from:#{{$todoValueId}}, change from:#{{$todoCompletedId}}"

    class="p-1.5 group rounded-lg mb-3 bg-transparent flex justify-center items-begin"
>
    <input name="id" type="hidden" value="{{.Id}}" />
    <input name="todolistid" type="hidden" value="{{.TodoListId}}" />

    <input 
        id="{{$todoCompletedId}}"
        name="completed"
        value="true"
        type="checkbox"

        hx-trigger="change"

        {{if .Completed}}checked{{end}}
        onchange="document.getElementById('{{$todoValueId}}').readOnly= this.checked"

        class="w-6 h-6 text-green-500 border-3 appearance-none outline-none cursor-pointer rounded-lg focus:outlint-none checked:bg-green-500 transition"
    />

    <textarea
        id="{{$todoValueId}}"
        name="value"
        type="text" 
        placeholder="Enter Value Here..." 
        autocomplete="off"


        {{if .Completed}}readonly{{end}}

        hx-post="/todos?setFocus=true"
        hx-trigger="keyup[event.code=='Enter']"
        hx-target="#{{$todoId}}"
        hx-swap="afterend"
        hx-vals='{"value": "{{$.Value}}"}'

        onkeydown="if (event.key === 'Enter') event.preventDefault();"

        class="placeholder:text-gray-500 text-xs no-scrollbar dark:placeholder:text-gray-300 field-sizing-content resize-none ml-3 min-w-0 max-w-120 flex-1 bg-transparent focus-visible:outline-none read-only:text-green-500 read-only:line-through" 
    >{{ .Value }}</textarea>

    <button 
        type="button"

        {{if .Completed}}disabled{{end}}

        hx-delete="/todos?id={{.Id}}"
        hx-target="#{{$todoId}}"
        hx-swap="outerHTML"

        class="flex items-center justify-center ml-3 w-6 h-6 font-medium bg-transparent rounded-full lg:opacity-0 lg:group-hover:opacity-100 duration-200 ease-in-out hover:scale-120 hover:bg-red-500 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-80 disabled:hidden"
    >
        {{template "x-mark-icon" .}}
    </button>
</form>
{{end}}
